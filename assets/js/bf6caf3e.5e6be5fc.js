"use strict";(globalThis.webpackChunkmne_cpp_website=globalThis.webpackChunkmne_cpp_website||[]).push([[1471],{48443(e,n,t){t.r(n),t.d(n,{assets:()=>r,contentTitle:()=>d,default:()=>h,frontMatter:()=>a,metadata:()=>i,toc:()=>o});const i=JSON.parse('{"id":"development/analyze-plugin","title":"Creating a new plugin","description":"This guide explains how to create a new MNE Analyze plugin, including implementing the required virtual functions, setting up GUI elements, and integrating with the event system.","source":"@site/docs/development/analyze-plugin.mdx","sourceDirName":"development","slug":"/development/analyze-plugin","permalink":"/docs/development/analyze-plugin","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{"title":"Creating a new plugin","sidebar_label":"Creating a Plugin"},"sidebar":"developmentSidebar","previous":{"title":"MNE Analyze","permalink":"/docs/development/analyze"},"next":{"title":"Event System","permalink":"/docs/development/analyze-event"}}');var l=t(74848),s=t(28453);const a={title:"Creating a new plugin",sidebar_label:"Creating a Plugin"},d="Creating a New Plugin",r={},o=[{value:"Overview",id:"overview",level:2},{value:"Sample Plugin",id:"sample-plugin",level:2},{value:"Deriving from AbstractPlugin",id:"deriving-from-abstractplugin",level:2},{value:"clone()",id:"clone",level:3},{value:"init()",id:"init",level:3},{value:"unload()",id:"unload",level:3},{value:"getName()",id:"getname",level:3},{value:"getMenu()",id:"getmenu",level:3},{value:"getControl()",id:"getcontrol",level:3},{value:"getView()",id:"getview",level:3},{value:"getEventSubscriptions()",id:"geteventsubscriptions",level:3},{value:"handleEvent()",id:"handleevent",level:3},{value:"Views and Controls",id:"views-and-controls",level:2},{value:"Using the Event System",id:"using-the-event-system",level:3},{value:"Setting and Clearing Data",id:"setting-and-clearing-data",level:3},{value:"Static Building",id:"static-building",level:2},{value:"Checklist",id:"checklist",level:2},{value:"Useful References",id:"useful-references",level:2}];function c(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",input:"input",li:"li",p:"p",pre:"pre",ul:"ul",...(0,s.R)(),...e.components};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(n.header,{children:(0,l.jsx)(n.h1,{id:"creating-a-new-plugin",children:"Creating a New Plugin"})}),"\n",(0,l.jsx)(n.p,{children:"This guide explains how to create a new MNE Analyze plugin, including implementing the required virtual functions, setting up GUI elements, and integrating with the event system."}),"\n",(0,l.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,l.jsxs)(n.p,{children:["All MNE Analyze plugins inherit from ",(0,l.jsx)(n.code,{children:"AbstractPlugin"})," (",(0,l.jsx)(n.code,{children:"applications/mne_analyze/libs/anShared/Plugins/abstractplugin.h"}),"). Unlike MNE Scan, MNE Analyze does not differentiate between plugin types."]}),"\n",(0,l.jsxs)(n.p,{children:["Plugins are loaded at runtime from ",(0,l.jsx)(n.code,{children:"bin/mne_analyze_plugins"}),". Once loaded, MNE Analyze retrieves each plugin's menus, controls, and views and displays them to the user. Currently each plugin returns at most one of each GUI element."]}),"\n",(0,l.jsx)(n.p,{children:"For implementation details, see:"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"analyzecore.cpp"})," \u2192 ",(0,l.jsx)(n.code,{children:"initPluginManager()"})," \u2014 how plugins are discovered and loaded"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"mainwindow.cpp"})," constructor \u2014 how GUI elements are assembled"]}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"sample-plugin",children:"Sample Plugin"}),"\n",(0,l.jsxs)(n.p,{children:["A sample plugin with no functionality is included in ",(0,l.jsx)(n.code,{children:"applications/mne_analyze/plugins/sampleplugin"}),". To create a new plugin, duplicate that folder and replace all instances of ",(0,l.jsx)(n.code,{children:"SamplePlugin"})," with your plugin name. See the checklist at the end of this guide for details that are easy to miss."]}),"\n",(0,l.jsx)(n.h2,{id:"deriving-from-abstractplugin",children:"Deriving from AbstractPlugin"}),"\n",(0,l.jsx)(n.p,{children:"AbstractPlugin has a number of pure virtual functions that need to be defined by any new plugin. Among them are functions for getting the view, control, and menu GUI items for the plugin, as well subscribing to and receiving events from the event manager."}),"\n",(0,l.jsx)(n.h3,{id:"clone",children:"clone()"}),"\n",(0,l.jsx)(n.p,{children:"Returns an instance of the plugin. This is not a copy. Most of the existing plugins do something like this:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-cpp",children:"return QSharedPointer<AbstractPlugin>(new Averaging);\n"})}),"\n",(0,l.jsx)(n.h3,{id:"init",children:"init()"}),"\n",(0,l.jsx)(n.p,{children:"Initializes the plugin. This gets called after all the plugins get loaded into the Plugin Manager. Any startup actions that need to be done before the user begins interacting with the plugin, such as allocating memory or initializing parameters, can be done here."}),"\n",(0,l.jsx)(n.h3,{id:"unload",children:"unload()"}),"\n",(0,l.jsx)(n.p,{children:"Closes the plugin. Gets called when the plugins are being shutdown when the main window is closed. Any shutdown actions that need to be performed before the program shuts down can be done here."}),"\n",(0,l.jsx)(n.h3,{id:"getname",children:"getName()"}),"\n",(0,l.jsx)(n.p,{children:"Returns the plugin name, this will be used to set the plugin title on any views, controls, and menu items the plugin has."}),"\n",(0,l.jsx)(n.h3,{id:"getmenu",children:"getMenu()"}),"\n",(0,l.jsxs)(n.p,{children:["Returns menu items to be added to the top dropdown menu bar. If the plugin does not need a menu, return a ",(0,l.jsx)(n.code,{children:"Q_NULLPTR"})," (null pointer) instead."]}),"\n",(0,l.jsx)(n.p,{children:"Create a menu object to return, and populate it with relevant actions. Below is a section of the data loader plugin as an example:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-cpp",children:'QMenu* pMenuFile = new QMenu(tr("File"));\n\nQAction* pActionLoad = new QAction(tr("Open"));\npActionLoad->setStatusTip(tr("Load a data file"));\nconnect(pActionLoad, &QAction::triggered,\n        this, &DataLoader::onLoadFilePressed);\n'})}),"\n",(0,l.jsx)(n.p,{children:"If the name of the menu matches an existing one, the new actions will be added to that existing menu, otherwise a new one will be created."}),"\n",(0,l.jsx)(n.h3,{id:"getcontrol",children:"getControl()"}),"\n",(0,l.jsxs)(n.p,{children:["Returns a ",(0,l.jsx)(n.code,{children:"QDockWidget*"})," containing the control GUI elements of the plugin. If the plugin does not need controls, return a ",(0,l.jsx)(n.code,{children:"Q_NULLPTR"})," (null pointer) instead. Here we also set the allowed docking areas and the tab name that appears when the plugin is docked."]}),"\n",(0,l.jsxs)(n.p,{children:["The controls are set by adding any ",(0,l.jsx)(n.code,{children:"QWidget"})," to the ",(0,l.jsx)(n.code,{children:"QDockWidget"})," that needs to be returned. Below is an example with a single widget, the tab name set to the plugin name, docked on the left or right sides of the window:"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-cpp",children:'QDockWidget* pControlDock = new QDockWidget(getName());\npControlDock->setAllowedAreas(Qt::LeftDockWidgetArea | Qt::RightDockWidgetArea);\npControlDock->setObjectName(getName());\n\nQPushButton* pSingleButton = new QPushButton("Compute");\npControlDock->setWidget(pSingleButton);\n'})}),"\n",(0,l.jsx)(n.p,{children:"This is useful if the control widget is already created. If instead the control widget needs to be created or multiple widgets need to be added, a layout can be used:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-cpp",children:'QDockWidget* pControlDock = new QDockWidget(getName());\npControlDock->setAllowedAreas(Qt::LeftDockWidgetArea | Qt::RightDockWidgetArea);\npControlDock->setObjectName(getName());\n\nQScrollArea* wrappedScrollArea = new QScrollArea(pControlDock);\nQVBoxLayout* pLayout = new QVBoxLayout;\npControlDock->setWidget(wrappedScrollArea);\n\nQPushButton* pFirstButton = new QPushButton("Compute");\nQPushButton* pSecondButton = new QPushButton("Clear");\n\npLayout->addWidget(pFirstButton);\npLayout->addWidget(pSecondButton);\n'})}),"\n",(0,l.jsx)(n.p,{children:"Many control widgets are already implemented in the Disp library and can be reused here."}),"\n",(0,l.jsxs)(n.p,{children:['To influence the ordering of your plugin\'s controls in the "Control" drop-down menu, modify the ',(0,l.jsx)(n.code,{children:"m_iOrder"})," variable. The default is 0; higher values place the controls higher in the menu. Negative values force controls to appear lower."]}),"\n",(0,l.jsx)(n.h3,{id:"getview",children:"getView()"}),"\n",(0,l.jsxs)(n.p,{children:["Returns a ",(0,l.jsx)(n.code,{children:"QWidget*"})," with the view GUI element of the plugin. If the plugin does not need a view, return a ",(0,l.jsx)(n.code,{children:"Q_NULLPTR"})," (null pointer) instead."]}),"\n",(0,l.jsx)(n.p,{children:"In all cases in MNE Analyze the view is created elsewhere and returned here as an instance. Many view widgets are already implemented in the Disp library and can be reused."}),"\n",(0,l.jsx)(n.h3,{id:"geteventsubscriptions",children:"getEventSubscriptions()"}),"\n",(0,l.jsxs)(n.p,{children:["Returns a ",(0,l.jsx)(n.code,{children:"QVector<EVENT_TYPE>"})," with the events the plugin is subscribed to. If the plugin does not care about incoming events, return an empty ",(0,l.jsx)(n.code,{children:"QVector"}),". See example below:"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-cpp",children:"QVector<EVENT_TYPE> temp;\ntemp.push_back(SELECTED_MODEL_CHANGED);\ntemp.push_back(FILTER_ACTIVE_CHANGED);\ntemp.push_back(FILTER_DESIGN_CHANGED);\n"})}),"\n",(0,l.jsx)(n.h3,{id:"handleevent",children:"handleEvent()"}),"\n",(0,l.jsxs)(n.p,{children:["Receives event ",(0,l.jsx)(n.code,{children:"e"})," that the plugin is subscribed to. Typically this is handled by a switch-case for each subscribed event:"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-cpp",children:'switch (e->getType()) {\n    case EVENT_TYPE::SELECTED_MODEL_CHANGED:\n        // do something\n        break;\n    case FILTER_ACTIVE_CHANGED:\n        // do something\n        break;\n    case FILTER_DESIGN_CHANGED:\n        // do something\n        break;\n    default:\n        qWarning() << "[Averaging::handleEvent] Received an Event that is not handled by switch cases.";\n}\n'})}),"\n",(0,l.jsx)(n.h2,{id:"views-and-controls",children:"Views and Controls"}),"\n",(0,l.jsxs)(n.p,{children:["Existing views and controls live in the Disp library and can be reused when building your plugin's GUI. Custom widgets can be created with Qt Designer (",(0,l.jsx)(n.code,{children:".ui"})," files). All views and controls subclass ",(0,l.jsx)(n.code,{children:"AbstractView"}),"."]}),"\n",(0,l.jsx)(n.h3,{id:"using-the-event-system",children:"Using the Event System"}),"\n",(0,l.jsxs)(n.p,{children:["Events are how MNE Analyze plugins communicate. Subscribe to events to receive notifications about loaded data, selected items, or scaling changes. Send events to broadcast data or trigger actions in other plugins. See the ",(0,l.jsx)(n.a,{href:"/docs/development/analyze-event",children:"Event System"})," page for details."]}),"\n",(0,l.jsx)(n.h3,{id:"setting-and-clearing-data",children:"Setting and Clearing Data"}),"\n",(0,l.jsxs)(n.p,{children:["Data is displayed using views that present the contents of models, following Qt's ",(0,l.jsx)(n.a,{href:"https://doc.qt.io/qt-6/model-view-programming.html",children:"Model/View"})," architecture."]}),"\n",(0,l.jsx)(n.h2,{id:"static-building",children:"Static Building"}),"\n",(0,l.jsxs)(n.p,{children:["When building statically, MNE Analyze needs to be told about the plugins at build time. To do this, the plugins are included with ",(0,l.jsx)(n.code,{children:"Q_IMPORT_PLUGIN"})," in ",(0,l.jsx)(n.code,{children:"applications/mne_analyze/mne_analyze/main.cpp"})," under the ",(0,l.jsx)(n.code,{children:"#ifdef STATICBUILD"})," macro. The CMake configuration handles the rest of the static build setup automatically."]}),"\n",(0,l.jsx)(n.h2,{id:"checklist",children:"Checklist"}),"\n",(0,l.jsx)(n.p,{children:"Before submitting your plugin as a pull request, verify:"}),"\n",(0,l.jsxs)(n.ul,{className:"contains-task-list",children:["\n",(0,l.jsxs)(n.li,{className:"task-list-item",children:[(0,l.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Plugin added to the ",(0,l.jsx)(n.code,{children:"CMakeLists.txt"})," in the plugins directory"]}),"\n",(0,l.jsxs)(n.li,{className:"task-list-item",children:[(0,l.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Plugin's own ",(0,l.jsx)(n.code,{children:"CMakeLists.txt"})," has correct target name, source files, and linked libraries"]}),"\n",(0,l.jsxs)(n.li,{className:"task-list-item",children:[(0,l.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Plugin has a ",(0,l.jsx)(n.code,{children:"*_global.h"})," file with export macros"]}),"\n",(0,l.jsxs)(n.li,{className:"task-list-item",children:[(0,l.jsx)(n.input,{type:"checkbox",disabled:!0})," ","All ",(0,l.jsx)(n.code,{children:"AbstractPlugin"})," virtual functions are implemented"]}),"\n",(0,l.jsxs)(n.li,{className:"task-list-item",children:[(0,l.jsx)(n.input,{type:"checkbox",disabled:!0})," ",(0,l.jsx)(n.code,{children:"Q_IMPORT_PLUGIN"})," added in ",(0,l.jsx)(n.code,{children:"main.cpp"})," for static builds"]}),"\n",(0,l.jsxs)(n.li,{className:"task-list-item",children:[(0,l.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Plugin compiles and loads successfully in MNE Analyze"]}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"useful-references",children:"Useful References"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"https://doc.qt.io/qt-6/layout.html",children:"Qt Layout Management"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"https://www.usability.gov/what-and-why/user-interface-design.html",children:"Basics of User Interface Design"})}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,l.jsx)(n,{...e,children:(0,l.jsx)(c,{...e})}):c(e)}},28453(e,n,t){t.d(n,{R:()=>a,x:()=>d});var i=t(96540);const l={},s=i.createContext(l);function a(e){const n=i.useContext(s);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(l):e.components||l:a(e.components),i.createElement(s.Provider,{value:n},e.children)}}}]);