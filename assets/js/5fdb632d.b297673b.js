"use strict";(globalThis.webpackChunkmne_cpp_website=globalThis.webpackChunkmne_cpp_website||[]).push([[6367],{57360(e,t,n){n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>o,default:()=>h,frontMatter:()=>r,metadata:()=>s,toc:()=>c});const s=JSON.parse('{"id":"development/writingtest","title":"Writing a Unit Test","description":"MNE-CPP requires unit tests for all new functionality. The focus is on functional testing rather than 100% code coverage. Writing tests helps you fully understand what your code does and ensures the CI pipeline catches regressions early \u2014 a failing test is the first indicator that a change broke something.","source":"@site/docs/development/writingtest.mdx","sourceDirName":"development","slug":"/development/writingtest","permalink":"/docs/development/writingtest","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{"title":"Writing a Unit Test","sidebar_label":"Writing a Unit Test"},"sidebar":"developmentSidebar","previous":{"title":"Contributing to the Website","permalink":"/docs/development/contr-docuimprovements"},"next":{"title":"MNE Tracer","permalink":"/docs/development/contr-mnetracer"}}');var i=n(74848),a=n(28453);const r={title:"Writing a Unit Test",sidebar_label:"Writing a Unit Test"},o="Writing a Unit Test",l={},c=[{value:"What and How to Test",id:"what-and-how-to-test",level:2},{value:"Creating a new Test",id:"creating-a-new-test",level:2},{value:"Structuring the Test",id:"structuring-the-test",level:2},{value:"initTestCase()",id:"inittestcase",level:3},{value:"compareValue()",id:"comparevalue",level:3},{value:"Possible Error Message",id:"possible-error-message",level:3},{value:"Naming Conventions",id:"naming-conventions",level:3}];function d(e){const t={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",...(0,a.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(t.header,{children:(0,i.jsx)(t.h1,{id:"writing-a-unit-test",children:"Writing a Unit Test"})}),"\n",(0,i.jsx)(t.p,{children:"MNE-CPP requires unit tests for all new functionality. The focus is on functional testing rather than 100% code coverage. Writing tests helps you fully understand what your code does and ensures the CI pipeline catches regressions early \u2014 a failing test is the first indicator that a change broke something."}),"\n",(0,i.jsx)(t.h2,{id:"what-and-how-to-test",children:"What and How to Test"}),"\n",(0,i.jsx)(t.p,{children:"Every new function should be tested. Consider the use case, determine how to validate the output, and \u2014 where possible \u2014 compare results against a reference implementation (e.g., MNE-Python, MNE-C, or MNE-Matlab). Once you have reference results, proceed with the steps below."}),"\n",(0,i.jsx)(t.h2,{id:"creating-a-new-test",children:"Creating a new Test"}),"\n",(0,i.jsxs)(t.p,{children:["A good starting point is to look at existing tests under ",(0,i.jsx)(t.code,{children:"src/testframes/"}),". You can duplicate an existing test directory (e.g., ",(0,i.jsx)(t.code,{children:"test_fiff_rwr"}),") and adapt it for your new test. Make sure to:"]}),"\n",(0,i.jsxs)(t.ol,{children:["\n",(0,i.jsx)(t.li,{children:"Rename the directory and source files to match your test name."}),"\n",(0,i.jsxs)(t.li,{children:["Update the ",(0,i.jsx)(t.code,{children:"CMakeLists.txt"})," inside the new test directory."]}),"\n",(0,i.jsxs)(t.li,{children:["Register the new test in the parent ",(0,i.jsx)(t.code,{children:"src/testframes/CMakeLists.txt"})," via ",(0,i.jsx)(t.code,{children:"add_subdirectory()"}),"."]}),"\n"]}),"\n",(0,i.jsx)(t.h2,{id:"structuring-the-test",children:"Structuring the Test"}),"\n",(0,i.jsxs)(t.p,{children:["Always keep our ",(0,i.jsx)(t.a,{href:"/docs/development/contr-style",children:"Coding Conventions"})," in mind. Consider taking a look at already available tests to get started. First, you create a class named after your test: ",(0,i.jsx)(t.code,{children:"TestName"}),". The following code snippet shows an example for a test. The ",(0,i.jsx)(t.code,{children:"slots"})," define the functions to execute your test logic in ",(0,i.jsx)(t.code,{children:"initTestCase()"})," and compare the output to reference values, e.g., ",(0,i.jsx)(t.code,{children:"compareValue()"}),". You can also declare threshold values as private variables that indicate the maximum allowed difference when comparing. An example can be found ",(0,i.jsx)(t.a,{href:"https://github.com/mne-tools/mne-cpp/blob/main/testframes/test_fiff_rwr/test_fiff_rwr.cpp",children:"here"}),"."]}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-cpp",children:"class TestFiffRWR: public QObject\n{\n    Q_OBJECT\n\npublic:\n    TestFiffRWR();\n\nprivate slots:\n    void initTestCase();\n    void compareValue();\n    void cleanupTestCase();\n\nprivate:\n    // some variables and error thresholds\n    double dEpsilon;\n    Eigen::MatrixXd mFirstInData;\n    Eigen::MatrixXd mSecondInData;\n};\n"})}),"\n",(0,i.jsx)(t.h3,{id:"inittestcase",children:"initTestCase()"}),"\n",(0,i.jsxs)(t.p,{children:["Here you execute and declare everything that is necessary for setting up your test. You generate and load all values in a variable that can be compared to later. If you want to load external calculated data in e.g. ",(0,i.jsx)(t.code,{children:".txt"})," files you can use:"]}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-cpp",children:'Eigen::MatrixXd mDataFromFile;\nUTILSLIB::IOUtils::read_eigen_matrix(mDataFromFile, QCoreApplication::applicationDirPath() + "../resources/data/mne-cpp-test-data/Result/<yourFile>.txt");\n'})}),"\n",(0,i.jsxs)(t.p,{children:["All files you use, have to be added to ",(0,i.jsx)(t.a,{href:"https://github.com/mne-tools/mne-cpp-test-data",children:"mne-cpp-test-data"}),". In case you need to add new data open a Pull Request to this repository. The files you use should be as small as possible. If you need a .fif file, have a look at the already existing data first."]}),"\n",(0,i.jsx)(t.h3,{id:"comparevalue",children:"compareValue()"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-cpp",children:"void TestFiffRWR::compareValue()\n{\n    // compare your data here, think about usefull metrics\n    Eigen::MatrixXd mDataDiff = mFirstInData - mSecondInData;\n    QVERIFY( mDataDiff.sum() < dEpsilon );\n}\n"})}),"\n",(0,i.jsxs)(t.p,{children:["Here you compare the output of your function to the reference data. ",(0,i.jsx)(t.code,{children:"QVERIFY"})," performs the assertion. Choose meaningful metrics and thresholds for your comparison. Use a separate compare function for each value you test \u2014 don't combine unrelated comparisons."]}),"\n",(0,i.jsx)(t.h3,{id:"possible-error-message",children:"Possible Error Message"}),"\n",(0,i.jsx)(t.p,{children:"It might be possible that the last line of the test shows an error in your editor. Don't worry about this, once you have built the test project, the error will disappear."}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-cpp",children:'#include "test_fiff_rwr.moc"\n'})}),"\n",(0,i.jsx)(t.h3,{id:"naming-conventions",children:"Naming Conventions"}),"\n",(0,i.jsx)(t.p,{children:"Please follow the following naming conventions when naming your test project and class:"}),"\n",(0,i.jsxs)(t.table,{children:[(0,i.jsx)(t.thead,{children:(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.th,{children:"Object"}),(0,i.jsx)(t.th,{children:"Rule"})]})}),(0,i.jsxs)(t.tbody,{children:[(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"Project name"}),(0,i.jsx)(t.td,{children:(0,i.jsx)(t.code,{children:"test_something_meaningful"})})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"Class name"}),(0,i.jsx)(t.td,{children:(0,i.jsx)(t.code,{children:"TestSomethingMeaningful"})})]})]})]})]})}function h(e={}){const{wrapper:t}={...(0,a.R)(),...e.components};return t?(0,i.jsx)(t,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},28453(e,t,n){n.d(t,{R:()=>r,x:()=>o});var s=n(96540);const i={},a=s.createContext(i);function r(e){const t=s.useContext(a);return s.useMemo(function(){return"function"==typeof e?e(t):{...t,...e}},[t,e])}function o(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:r(e.components),s.createElement(a.Provider,{value:t},e.children)}}}]);