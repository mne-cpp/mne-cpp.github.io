"use strict";(globalThis.webpackChunkmne_cpp_website=globalThis.webpackChunkmne_cpp_website||[]).push([[8388],{24274(e,s,i){i.r(s),i.d(s,{assets:()=>a,contentTitle:()=>r,default:()=>h,frontMatter:()=>d,metadata:()=>n,toc:()=>c});const n=JSON.parse('{"id":"development/wasm-buildguide","title":"Build Guide","description":"This guide shows you how to build MNE-CPP for WebAssembly (Wasm). MNE-CPP uses multi-threaded Wasm by default and provides a build script that handles Emscripten setup, CMake configuration, and compilation.","source":"@site/docs/development/wasm-buildguide.mdx","sourceDirName":"development","slug":"/development/wasm-buildguide","permalink":"/docs/development/wasm-buildguide","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{"title":"Build Guide","sidebar_label":"Build Guide"},"sidebar":"developmentSidebar","previous":{"title":"WebAssembly","permalink":"/docs/development/wasm"},"next":{"title":"Testing via CI","permalink":"/docs/development/wasm-testing"}}');var t=i(74848),l=i(28453);const d={title:"Build Guide",sidebar_label:"Build Guide"},r="WebAssembly Build Guide",a={},c=[{value:"Prerequisites",id:"prerequisites",level:2},{value:"Qt 6 for WebAssembly",id:"qt-6-for-webassembly",level:3},{value:"Emscripten SDK",id:"emscripten-sdk",level:3},{value:"System Dependencies",id:"system-dependencies",level:3},{value:"CMake",id:"cmake",level:3},{value:"Build with the Provided Script",id:"build-with-the-provided-script",level:2},{value:"Script Options",id:"script-options",level:3},{value:"Build Manually",id:"build-manually",level:2},{value:"Run an Application",id:"run-an-application",level:2},{value:"Live Demo",id:"live-demo",level:2},{value:"Notes",id:"notes",level:2},{value:"References",id:"references",level:2}];function o(e){const s={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,l.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(s.header,{children:(0,t.jsx)(s.h1,{id:"webassembly-build-guide",children:"WebAssembly Build Guide"})}),"\n",(0,t.jsxs)(s.p,{children:["This guide shows you how to build MNE-CPP for WebAssembly (Wasm). MNE-CPP uses ",(0,t.jsx)(s.strong,{children:"multi-threaded"})," Wasm by default and provides a build script that handles Emscripten setup, CMake configuration, and compilation."]}),"\n",(0,t.jsx)(s.h2,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,t.jsx)(s.h3,{id:"qt-6-for-webassembly",children:"Qt 6 for WebAssembly"}),"\n",(0,t.jsxs)(s.p,{children:["You need a Qt 6 installation that includes the ",(0,t.jsx)(s.strong,{children:"WebAssembly (multi-threaded)"})," target. Install it via the ",(0,t.jsx)(s.a,{href:"https://www.qt.io/download-qt-installer",children:"Qt Online Installer"})," \u2014 select both a desktop target (e.g. ",(0,t.jsx)(s.code,{children:"Desktop gcc 64-bit"})," on Linux or ",(0,t.jsx)(s.code,{children:"macOS"})," on Mac) and the ",(0,t.jsx)(s.code,{children:"WebAssembly (multi-threaded)"})," target. CI currently uses ",(0,t.jsx)(s.strong,{children:"Qt 6.10.2"}),"."]}),"\n",(0,t.jsx)(s.p,{children:"A desktop (host) Qt is required alongside the Wasm Qt because Qt's cross-compilation needs a host toolchain to build code generators and other tools."}),"\n",(0,t.jsx)(s.h3,{id:"emscripten-sdk",children:"Emscripten SDK"}),"\n",(0,t.jsxs)(s.p,{children:["The build script can automatically download and set up the Emscripten SDK for you. If you prefer to install it manually, see ",(0,t.jsx)(s.a,{href:"https://emscripten.org/docs/getting_started/downloads.html",children:"emscripten.org"}),". CI currently uses ",(0,t.jsx)(s.strong,{children:"emsdk 4.0.7"}),"."]}),"\n",(0,t.jsx)(s.h3,{id:"system-dependencies",children:"System Dependencies"}),"\n",(0,t.jsxs)(s.p,{children:["On ",(0,t.jsx)(s.strong,{children:"Linux"}),", install the following packages:"]}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-bash",children:"sudo apt-get install build-essential libgl1-mesa-dev ninja-build\n"})}),"\n",(0,t.jsxs)(s.p,{children:["On ",(0,t.jsx)(s.strong,{children:"macOS"}),", install Ninja:"]}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-bash",children:"brew install ninja\n"})}),"\n",(0,t.jsx)(s.h3,{id:"cmake",children:"CMake"}),"\n",(0,t.jsxs)(s.p,{children:[(0,t.jsx)(s.a,{href:"https://cmake.org/download/",children:"CMake"})," ",(0,t.jsx)(s.strong,{children:"3.15 or higher"})," is required."]}),"\n",(0,t.jsx)(s.h2,{id:"build-with-the-provided-script",children:"Build with the Provided Script"}),"\n",(0,t.jsxs)(s.p,{children:["MNE-CPP provides a Wasm build script at ",(0,t.jsx)(s.code,{children:"tools/wasm.sh"}),". From the repository root:"]}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-bash",children:"# Set Qt6_DIR to the folder containing wasm_multithread/ and your host Qt (gcc_64/ or macos/)\nexport Qt6_DIR=$HOME/Qt/6.10.2\n\n./tools/wasm.sh\n"})}),"\n",(0,t.jsx)(s.p,{children:"The script will:"}),"\n",(0,t.jsxs)(s.ol,{children:["\n",(0,t.jsx)(s.li,{children:"Clone and activate the Emscripten SDK (version 4.0.7 by default)"}),"\n",(0,t.jsxs)(s.li,{children:["Auto-detect the host Qt path from ",(0,t.jsx)(s.code,{children:"Qt6_DIR"})]}),"\n",(0,t.jsxs)(s.li,{children:["Run ",(0,t.jsx)(s.code,{children:"qt-cmake"})," with ",(0,t.jsx)(s.code,{children:"-DWASM=ON"})]}),"\n",(0,t.jsx)(s.li,{children:"Build MNE-CPP for WebAssembly"}),"\n"]}),"\n",(0,t.jsxs)(s.p,{children:["Build output is placed in ",(0,t.jsx)(s.code,{children:"out/wasm/"}),"."]}),"\n",(0,t.jsx)(s.h3,{id:"script-options",children:"Script Options"}),"\n",(0,t.jsxs)(s.table,{children:[(0,t.jsx)(s.thead,{children:(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.th,{children:"Option"}),(0,t.jsx)(s.th,{children:"Description"})]})}),(0,t.jsxs)(s.tbody,{children:[(0,t.jsxs)(s.tr,{children:[(0,t.jsxs)(s.td,{children:[(0,t.jsx)(s.code,{children:"--emsdk <version>"}),", ",(0,t.jsx)(s.code,{children:"-e"})]}),(0,t.jsx)(s.td,{children:"Set the Emscripten version (default: 4.0.7)"})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsxs)(s.td,{children:[(0,t.jsx)(s.code,{children:"--qt <path>"}),", ",(0,t.jsx)(s.code,{children:"-q"})]}),(0,t.jsx)(s.td,{children:"Set the Qt installation path manually"})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"--qt-host <path>"})}),(0,t.jsx)(s.td,{children:"Set the host Qt path for cross-compilation"})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"--no-log"})}),(0,t.jsxs)(s.td,{children:["Skip writing ",(0,t.jsx)(s.code,{children:"build_info.txt"})]})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsxs)(s.td,{children:[(0,t.jsx)(s.code,{children:"--help"}),", ",(0,t.jsx)(s.code,{children:"-h"})]}),(0,t.jsx)(s.td,{children:"Show help"})]})]})]}),"\n",(0,t.jsx)(s.p,{children:"Example with explicit paths:"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-bash",children:"./tools/wasm.sh --emsdk 4.0.7 --qt $HOME/Qt/6.10.2 --qt-host $HOME/Qt/6.10.2/gcc_64\n"})}),"\n",(0,t.jsx)(s.h2,{id:"build-manually",children:"Build Manually"}),"\n",(0,t.jsx)(s.p,{children:"If you prefer to run the steps yourself:"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-bash",children:"# 1. Set up Emscripten\ngit clone https://github.com/emscripten-core/emsdk.git\ncd emsdk\n./emsdk install 4.0.7\n./emsdk activate 4.0.7\nsource ./emsdk_env.sh\ncd ..\n\n# 2. Configure and build\n$HOME/Qt/6.10.2/wasm_multithread/bin/qt-cmake \\\n  -DQT_HOST_PATH=$HOME/Qt/6.10.2/gcc_64 \\\n  -DCMAKE_BUILD_TYPE=Release \\\n  -DWASM=ON \\\n  -S src \\\n  -B build/wasm\n\ncmake --build build/wasm --parallel $(nproc)\n"})}),"\n",(0,t.jsxs)(s.p,{children:["Adjust ",(0,t.jsx)(s.code,{children:"QT_HOST_PATH"})," to ",(0,t.jsx)(s.code,{children:"gcc_64"})," (Linux) or ",(0,t.jsx)(s.code,{children:"macos"})," (macOS) as appropriate."]}),"\n",(0,t.jsx)(s.h2,{id:"run-an-application",children:"Run an Application"}),"\n",(0,t.jsx)(s.p,{children:"Navigate to the build output directory and start a local web server:"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-bash",children:"cd out/wasm/apps\npython3 -m http.server\n"})}),"\n",(0,t.jsx)(s.p,{children:"Open a Chromium-based browser or Firefox and visit:"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{children:"http://localhost:8000/mne_analyze.html\n"})}),"\n",(0,t.jsxs)(s.admonition,{title:"Cross-Origin Headers",type:"caution",children:[(0,t.jsxs)(s.p,{children:["Multi-threaded Wasm requires the server to send the ",(0,t.jsx)(s.code,{children:"Cross-Origin-Opener-Policy: same-origin"})," and ",(0,t.jsx)(s.code,{children:"Cross-Origin-Embedder-Policy: require-corp"})," headers. Without these headers, ",(0,t.jsx)(s.code,{children:"SharedArrayBuffer"})," is unavailable and the application will ",(0,t.jsx)(s.strong,{children:"hang silently"})," in Chrome and Safari (Edge is more permissive)."]}),(0,t.jsxs)(s.p,{children:[(0,t.jsx)(s.strong,{children:"Automatic fix (recommended):"})," Run the post-build script to inject a ",(0,t.jsx)(s.a,{href:"https://github.com/nickvdp/coi-serviceworker",children:"COI service worker"})," that adds these headers client-side \u2014 this works on any static host including GitHub Pages:"]}),(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-bash",children:"./tools/wasm/wasm_postbuild.sh out/wasm/apps\n"})}),(0,t.jsxs)(s.p,{children:["The ",(0,t.jsx)(s.code,{children:"wasm.sh"})," build script runs this automatically. If you build manually with CMake, run the command above after ",(0,t.jsx)(s.code,{children:"cmake --build"}),"."]}),(0,t.jsxs)(s.p,{children:[(0,t.jsx)(s.strong,{children:"Alternative for local testing:"})," Use a server that sends COOP/COEP headers, e.g.:"]}),(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-bash",children:"npx coi-serviceworker-server out/wasm/apps\n"})}),(0,t.jsxs)(s.p,{children:["See the ",(0,t.jsx)(s.a,{href:"https://doc.qt.io/qt-6/wasm.html",children:"Qt for WebAssembly documentation"})," for details."]})]}),"\n",(0,t.jsx)(s.h2,{id:"live-demo",children:"Live Demo"}),"\n",(0,t.jsx)(s.p,{children:"Live Wasm builds are available at:"}),"\n",(0,t.jsx)(s.p,{children:(0,t.jsx)(s.a,{href:"https://mne-cpp.github.io/wasm/mne_analyze.html",children:"https://mne-cpp.github.io/wasm/mne_analyze.html"})}),"\n",(0,t.jsx)(s.h2,{id:"notes",children:"Notes"}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsx)(s.li,{children:"Chromium-based browsers and Firefox provide the best compatibility."}),"\n",(0,t.jsxs)(s.li,{children:["Qt3D / QOpenGLWidget is not supported in WebAssembly builds (",(0,t.jsx)(s.code,{children:"-DNO_OPENGL"})," is implied by ",(0,t.jsx)(s.code,{children:"-DWASM=ON"}),")."]}),"\n",(0,t.jsxs)(s.li,{children:["The Wasm build always uses ",(0,t.jsx)(s.strong,{children:"static linking"})," (",(0,t.jsx)(s.code,{children:"BUILD_SHARED_LIBS=OFF"}),")."]}),"\n"]}),"\n",(0,t.jsx)(s.h2,{id:"references",children:"References"}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsx)(s.li,{children:(0,t.jsx)(s.a,{href:"https://doc.qt.io/qt-6/wasm.html",children:"Qt for WebAssembly"})}),"\n",(0,t.jsx)(s.li,{children:(0,t.jsx)(s.a,{href:"https://emscripten.org/docs/",children:"Emscripten documentation"})}),"\n",(0,t.jsx)(s.li,{children:(0,t.jsx)(s.a,{href:"https://wiki.qt.io/Qt_for_WebAssembly",children:"Qt for WebAssembly wiki"})}),"\n"]})]})}function h(e={}){const{wrapper:s}={...(0,l.R)(),...e.components};return s?(0,t.jsx)(s,{...e,children:(0,t.jsx)(o,{...e})}):o(e)}},28453(e,s,i){i.d(s,{R:()=>d,x:()=>r});var n=i(96540);const t={},l=n.createContext(t);function d(e){const s=n.useContext(l);return n.useMemo(function(){return"function"==typeof e?e(s):{...s,...e}},[s,e])}function r(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:d(e.components),n.createElement(l.Provider,{value:s},e.children)}}}]);