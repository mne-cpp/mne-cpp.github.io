"use strict";(globalThis.webpackChunkmne_cpp_website=globalThis.webpackChunkmne_cpp_website||[]).push([[2163],{56555(e,n,a){a.r(n),a.d(n,{assets:()=>i,contentTitle:()=>r,default:()=>h,frontMatter:()=>o,metadata:()=>t,toc:()=>s});const t=JSON.parse('{"id":"development/analyze-datamodel","title":"Creating a new data model","description":"MNE Analyze uses the Model/View architecture from Qt to separate data storage from presentation. All data \u2014 FIFF files, annotations, averages \u2014 is represented as a model that views can display. This guide explains how to create a new data model for a custom data type.","source":"@site/docs/development/analyze-datamodel.mdx","sourceDirName":"development","slug":"/development/analyze-datamodel","permalink":"/docs/development/analyze-datamodel","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{"title":"Creating a new data model","sidebar_label":"Data Model"},"sidebar":"developmentSidebar","previous":{"title":"Event System","permalink":"/docs/development/analyze-event"}}');var d=a(74848),l=a(28453);const o={title:"Creating a new data model",sidebar_label:"Data Model"},r="Creating a New Data Model",i={},s=[{value:"Architecture Overview",id:"architecture-overview",level:2},{value:"Subclassing AbstractModel",id:"subclassing-abstractmodel",level:2},{value:"Pure Virtual Functions",id:"pure-virtual-functions",level:3},{value:"<code>getType()</code>",id:"gettype",level:4},{value:"<code>data()</code>",id:"data",level:4},{value:"<code>flags()</code>",id:"flags",level:4},{value:"<code>index()</code>",id:"index",level:4},{value:"<code>parent()</code>",id:"parent",level:4},{value:"<code>rowCount()</code>",id:"rowcount",level:4},{value:"<code>columnCount()</code>",id:"columncount",level:4},{value:"Optional: <code>saveToFile()</code>",id:"optional-savetofile",level:3},{value:"Registering with the Data Loader and Data Manager",id:"registering-with-the-data-loader-and-data-manager",level:2},{value:"Loading from Files",id:"loading-from-files",level:3},{value:"Adding Models Programmatically",id:"adding-models-programmatically",level:3},{value:"Saving to Files",id:"saving-to-files",level:3},{value:"Complete Minimal Example",id:"complete-minimal-example",level:2},{value:"Using Your Model in a Plugin",id:"using-your-model-in-a-plugin",level:2}];function c(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",...(0,l.R)(),...e.components};return(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(n.header,{children:(0,d.jsx)(n.h1,{id:"creating-a-new-data-model",children:"Creating a New Data Model"})}),"\n",(0,d.jsxs)(n.p,{children:["MNE Analyze uses the ",(0,d.jsx)(n.a,{href:"https://doc.qt.io/qt-6/model-view-programming.html",children:"Model/View"})," architecture from Qt to separate data storage from presentation. All data \u2014 FIFF files, annotations, averages \u2014 is represented as a ",(0,d.jsx)(n.strong,{children:"model"})," that views can display. This guide explains how to create a new data model for a custom data type."]}),"\n",(0,d.jsx)(n.h2,{id:"architecture-overview",children:"Architecture Overview"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{children:"\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510     \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510     \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502    Data Loader   \u2502\u2500\u2500\u2500\u2500\u25ba\u2502   Data Manager    \u2502\u2500\u2500\u2500\u2500\u25ba\u2502      Views       \u2502\n\u2502  (loads files)   \u2502     \u2502 (stores models)   \u2502     \u2502 (display models) \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518     \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518     \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                                \u2502\n                         \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u25bc\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n                         \u2502 AbstractModel\u2502\n                         \u2502  (your new  \u2502\n                         \u2502   subclass) \u2502\n                         \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n"})}),"\n",(0,d.jsxs)(n.p,{children:["All data models inherit from ",(0,d.jsx)(n.code,{children:"AbstractModel"}),", which itself extends ",(0,d.jsx)(n.code,{children:"QAbstractItemModel"}),". The ",(0,d.jsx)(n.code,{children:"DataLoader"})," reads files from disk and creates model instances, while the ",(0,d.jsx)(n.code,{children:"DataManager"})," (via ",(0,d.jsx)(n.code,{children:"AnalyzeData"}),") stores and manages them. Plugins access models through the event system."]}),"\n",(0,d.jsx)(n.h2,{id:"subclassing-abstractmodel",children:"Subclassing AbstractModel"}),"\n",(0,d.jsxs)(n.p,{children:[(0,d.jsx)(n.code,{children:"AbstractModel"})," is located at ",(0,d.jsx)(n.code,{children:"applications/mne_analyze/libs/anShared/Model/abstractmodel.h"}),". Since it extends ",(0,d.jsx)(n.code,{children:"QAbstractItemModel"}),", you must implement all pure virtual functions from both classes."]}),"\n",(0,d.jsx)(n.h3,{id:"pure-virtual-functions",children:"Pure Virtual Functions"}),"\n",(0,d.jsx)(n.h4,{id:"gettype",children:(0,d.jsx)(n.code,{children:"getType()"})}),"\n",(0,d.jsxs)(n.p,{children:["Returns the type identifier for your model. Add a new entry to the ",(0,d.jsx)(n.code,{children:"MODEL_TYPE"})," enum in ",(0,d.jsx)(n.code,{children:"applications/mne_analyze/libs/anShared/Utils/types.h"}),":"]}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-cpp",children:"enum MODEL_TYPE {\n    ANSHAREDLIB_FIFFRAW_MODEL,\n    ANSHAREDLIB_ANNOTATION_MODEL,\n    ANSHAREDLIB_AVERAGING_MODEL,\n    ANSHAREDLIB_MYDATA_MODEL,    // \u2190 add your type here\n};\n"})}),"\n",(0,d.jsx)(n.p,{children:"Then implement:"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-cpp",children:"MODEL_TYPE MyDataModel::getType() const\n{\n    return MODEL_TYPE::ANSHAREDLIB_MYDATA_MODEL;\n}\n"})}),"\n",(0,d.jsx)(n.h4,{id:"data",children:(0,d.jsx)(n.code,{children:"data()"})}),"\n",(0,d.jsx)(n.p,{children:"Returns data for a given model index and role. This is the primary function that views call to retrieve displayable content:"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-cpp",children:"QVariant MyDataModel::data(const QModelIndex& index, int role) const\n{\n    if (!index.isValid())\n        return QVariant();\n\n    if (role == Qt::DisplayRole) {\n        // Return data based on row and column\n        return m_data.at(index.row()).at(index.column());\n    }\n\n    return QVariant();\n}\n"})}),"\n",(0,d.jsx)(n.h4,{id:"flags",children:(0,d.jsx)(n.code,{children:"flags()"})}),"\n",(0,d.jsx)(n.p,{children:"Returns item flags (selectable, editable, enabled, etc.):"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-cpp",children:"Qt::ItemFlags MyDataModel::flags(const QModelIndex& index) const\n{\n    if (!index.isValid())\n        return Qt::NoItemFlags;\n\n    return Qt::ItemIsEnabled | Qt::ItemIsSelectable;\n}\n"})}),"\n",(0,d.jsx)(n.h4,{id:"index",children:(0,d.jsx)(n.code,{children:"index()"})}),"\n",(0,d.jsxs)(n.p,{children:["Creates and returns a ",(0,d.jsx)(n.code,{children:"QModelIndex"})," for the given row, column, and parent:"]}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-cpp",children:"QModelIndex MyDataModel::index(int row, int column, const QModelIndex& parent) const\n{\n    Q_UNUSED(parent)\n    if (row < 0 || row >= rowCount() || column < 0 || column >= columnCount())\n        return QModelIndex();\n\n    return createIndex(row, column);\n}\n"})}),"\n",(0,d.jsx)(n.h4,{id:"parent",children:(0,d.jsx)(n.code,{children:"parent()"})}),"\n",(0,d.jsx)(n.p,{children:"Returns the parent index. For flat (non-hierarchical) models, return an empty index:"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-cpp",children:"QModelIndex MyDataModel::parent(const QModelIndex& index) const\n{\n    Q_UNUSED(index)\n    return QModelIndex();\n}\n"})}),"\n",(0,d.jsx)(n.h4,{id:"rowcount",children:(0,d.jsx)(n.code,{children:"rowCount()"})}),"\n",(0,d.jsxs)(n.p,{children:["Returns the number of rows. The meaning depends on your data \u2014 for example, the ",(0,d.jsx)(n.code,{children:"FiffRawViewModel"})," returns the number of channels:"]}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-cpp",children:"int MyDataModel::rowCount(const QModelIndex& parent) const\n{\n    Q_UNUSED(parent)\n    return m_data.size();\n}\n"})}),"\n",(0,d.jsx)(n.h4,{id:"columncount",children:(0,d.jsx)(n.code,{children:"columnCount()"})}),"\n",(0,d.jsx)(n.p,{children:"Returns the number of columns:"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-cpp",children:"int MyDataModel::columnCount(const QModelIndex& parent) const\n{\n    Q_UNUSED(parent)\n    return m_iNumColumns;\n}\n"})}),"\n",(0,d.jsxs)(n.h3,{id:"optional-savetofile",children:["Optional: ",(0,d.jsx)(n.code,{children:"saveToFile()"})]}),"\n",(0,d.jsxs)(n.p,{children:["If your model supports saving data back to disk, override ",(0,d.jsx)(n.code,{children:"saveToFile()"})," from ",(0,d.jsx)(n.code,{children:"AbstractModel"}),":"]}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-cpp",children:'bool MyDataModel::saveToFile(const QString& sPath)\n{\n    QFile file(sPath);\n    if (!file.open(QIODevice::WriteOnly)) {\n        qWarning() << "[MyDataModel::saveToFile] Could not open" << sPath;\n        return false;\n    }\n    // Write your data format\n    // ...\n    return true;\n}\n'})}),"\n",(0,d.jsx)(n.h2,{id:"registering-with-the-data-loader-and-data-manager",children:"Registering with the Data Loader and Data Manager"}),"\n",(0,d.jsx)(n.h3,{id:"loading-from-files",children:"Loading from Files"}),"\n",(0,d.jsx)(n.p,{children:"To allow users to load your data type from a file:"}),"\n",(0,d.jsxs)(n.ol,{children:["\n",(0,d.jsxs)(n.li,{children:["In ",(0,d.jsx)(n.code,{children:"DataLoader::loadFilePath()"}),", add support for your file extension so that the file dialog recognizes it."]}),"\n",(0,d.jsx)(n.li,{children:"In the load handler, create a new instance of your model and pass it to the data manager."}),"\n"]}),"\n",(0,d.jsx)(n.h3,{id:"adding-models-programmatically",children:"Adding Models Programmatically"}),"\n",(0,d.jsx)(n.p,{children:"To create a model from within a plugin (e.g., computed results rather than files):"}),"\n",(0,d.jsxs)(n.ol,{children:["\n",(0,d.jsxs)(n.li,{children:["In ",(0,d.jsx)(n.code,{children:"AnalyzeData.h"}),", extend ",(0,d.jsx)(n.code,{children:"addModel()"})," to handle your ",(0,d.jsx)(n.code,{children:"MODEL_TYPE"}),"."]}),"\n",(0,d.jsxs)(n.li,{children:["Specify the data type your model corresponds to \u2014 see ",(0,d.jsx)(n.code,{children:"bidsviewmodel.h"})," for the available types, or add a new one."]}),"\n"]}),"\n",(0,d.jsx)(n.h3,{id:"saving-to-files",children:"Saving to Files"}),"\n",(0,d.jsxs)(n.p,{children:["To support saving, ensure your file extension is included in ",(0,d.jsx)(n.code,{children:"DataLoader::onSaveFilePressed()"}),", and implement ",(0,d.jsx)(n.code,{children:"saveToFile()"})," in your model."]}),"\n",(0,d.jsx)(n.h2,{id:"complete-minimal-example",children:"Complete Minimal Example"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-cpp",children:'// mydatamodel.h\n#pragma once\n\n#include "../Utils/types.h"\n#include "abstractmodel.h"\n\nclass MyDataModel : public ANSHAREDLIB::AbstractModel\n{\n    Q_OBJECT\n\npublic:\n    MyDataModel(const QList<QStringList>& data, QObject* parent = nullptr);\n\n    // AbstractModel\n    MODEL_TYPE getType() const override;\n\n    // QAbstractItemModel\n    QVariant data(const QModelIndex& index, int role) const override;\n    Qt::ItemFlags flags(const QModelIndex& index) const override;\n    QModelIndex index(int row, int col, const QModelIndex& parent = QModelIndex()) const override;\n    QModelIndex parent(const QModelIndex& index) const override;\n    int rowCount(const QModelIndex& parent = QModelIndex()) const override;\n    int columnCount(const QModelIndex& parent = QModelIndex()) const override;\n\nprivate:\n    QList<QStringList> m_data;\n};\n'})}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-cpp",children:'// mydatamodel.cpp\n#include "mydatamodel.h"\n\nMyDataModel::MyDataModel(const QList<QStringList>& data, QObject* parent)\n    : AbstractModel(parent)\n    , m_data(data)\n{\n}\n\nMODEL_TYPE MyDataModel::getType() const\n{\n    return MODEL_TYPE::ANSHAREDLIB_MYDATA_MODEL;\n}\n\nQVariant MyDataModel::data(const QModelIndex& index, int role) const\n{\n    if (!index.isValid() || role != Qt::DisplayRole)\n        return QVariant();\n\n    return m_data.at(index.row()).at(index.column());\n}\n\nQt::ItemFlags MyDataModel::flags(const QModelIndex& index) const\n{\n    return index.isValid() ? (Qt::ItemIsEnabled | Qt::ItemIsSelectable) : Qt::NoItemFlags;\n}\n\nQModelIndex MyDataModel::index(int row, int col, const QModelIndex& parent) const\n{\n    Q_UNUSED(parent)\n    return createIndex(row, col);\n}\n\nQModelIndex MyDataModel::parent(const QModelIndex& index) const\n{\n    Q_UNUSED(index)\n    return QModelIndex();\n}\n\nint MyDataModel::rowCount(const QModelIndex& parent) const\n{\n    Q_UNUSED(parent)\n    return m_data.size();\n}\n\nint MyDataModel::columnCount(const QModelIndex& parent) const\n{\n    Q_UNUSED(parent)\n    return m_data.isEmpty() ? 0 : m_data.first().size();\n}\n'})}),"\n",(0,d.jsx)(n.h2,{id:"using-your-model-in-a-plugin",children:"Using Your Model in a Plugin"}),"\n",(0,d.jsx)(n.p,{children:"Once registered, your plugin can create and display the model:"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-cpp",children:"// In your plugin's handleEvent() or a load function:\nQList<QStringList> data = parseMyFile(sFilePath);\nauto pModel = QSharedPointer<MyDataModel>::create(data);\n\n// Notify MNE Analyze about the new model via the event system\nQVariant varModel = QVariant::fromValue(pModel);\nm_pCommu->publishEvent(EVENT_TYPE::NEW_MODEL_AVAILABLE, varModel);\n"})}),"\n",(0,d.jsxs)(n.p,{children:["Views that are subscribed to ",(0,d.jsx)(n.code,{children:"NEW_MODEL_AVAILABLE"})," will then receive and display the model."]})]})}function h(e={}){const{wrapper:n}={...(0,l.R)(),...e.components};return n?(0,d.jsx)(n,{...e,children:(0,d.jsx)(c,{...e})}):c(e)}},28453(e,n,a){a.d(n,{R:()=>o,x:()=>r});var t=a(96540);const d={},l=t.createContext(d);function o(e){const n=t.useContext(l);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(d):e.components||d:o(e.components),t.createElement(l.Provider,{value:n},e.children)}}}]);