"use strict";(globalThis.webpackChunkmne_cpp_website=globalThis.webpackChunkmne_cpp_website||[]).push([[8160],{52717(e,n,i){i.r(n),i.d(n,{assets:()=>s,contentTitle:()=>o,default:()=>h,frontMatter:()=>a,metadata:()=>r,toc:()=>l});const r=JSON.parse('{"id":"development/contr-mnetracer","title":"MNE Tracer","description":"It is very hard to improve what you cannot measure.","source":"@site/docs/development/contr-mnetracer.mdx","sourceDirName":"development","slug":"/development/contr-mnetracer","permalink":"/docs/development/contr-mnetracer","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{"title":"MNE Tracer","sidebar_label":"MNE Tracer"},"sidebar":"developmentSidebar","previous":{"title":"Writing a Unit Test","permalink":"/docs/development/writingtest"},"next":{"title":"Library API","permalink":"/docs/development/api"}}');var t=i(74848),c=i(28453);const a={title:"MNE Tracer",sidebar_label:"MNE Tracer"},o="MNE Tracer",s={},l=[{value:"Adding MNE Tracer to Your Code",id:"adding-mne-tracer-to-your-code",level:2},{value:"Using MNE Tracer",id:"using-mne-tracer",level:2},{value:"Enabling and Disabling the Tracer",id:"enabling-and-disabling-the-tracer",level:3},{value:"Specifying Which Functions to Trace",id:"specifying-which-functions-to-trace",level:3},{value:"Automatically Tracing All Methods in a Class",id:"automatically-tracing-all-methods-in-a-class",level:3}];function d(e){const n={blockquote:"blockquote",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",header:"header",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,c.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.header,{children:(0,t.jsx)(n.h1,{id:"mne-tracer",children:"MNE Tracer"})}),"\n",(0,t.jsxs)(n.blockquote,{children:["\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.em,{children:"It is very hard to improve what you cannot measure."})}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"During development it is common to have to decide between two (or more) different but equivalent implementations. We value improving code maintainability and coherence on top of achieving efficient implementations. But it is not uncommon to find situations where two solutions seem equally valid. Being able to understand the performance implications of each option helps make informed decisions and learn through the process. MNE Tracer was designed for exactly these situations \u2014 it is a code tracing tool that records when specified methods are executed."}),"\n",(0,t.jsxs)(n.p,{children:["MNE Tracer writes a JSON file where each traced function call is recorded as an event. The format is compatible with Google Chrome\u2019s built-in tracer (",(0,t.jsx)(n.code,{children:"chrome://tracing"}),") and with QtCreator\u2019s tracer plugin. To visualize your trace, open Chrome, navigate to ",(0,t.jsx)(n.code,{children:"chrome://tracing"}),", and load the generated JSON file."]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{src:i(38522).A+"",width:"1887",height:"913"})}),"\n",(0,t.jsx)(n.h2,{id:"adding-mne-tracer-to-your-code",children:"Adding MNE Tracer to Your Code"}),"\n",(0,t.jsx)(n.p,{children:"There are three steps to integrate MNE Tracer:"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Link the Utils library."})," The tracing functionality lives in the Utils library (",(0,t.jsx)(n.code,{children:"src/libraries/utils"}),"). If you are using the standard MNE-CPP build setup, Utils is linked by default. Verify that it is listed in your target\u2019s ",(0,t.jsx)(n.code,{children:"CMakeLists.txt"}),"."]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:[(0,t.jsxs)(n.strong,{children:["Define the ",(0,t.jsx)(n.code,{children:"TRACE"})," macro."]})," You can do this by passing ",(0,t.jsx)(n.code,{children:"-DTRACE=ON"})," to CMake or by adding ",(0,t.jsx)(n.code,{children:"#define TRACE"})," before including the MNE Tracer header:"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"cmake -B build -S . -DTRACE=ON\n"})}),"\n",(0,t.jsxs)(n.ol,{start:"3",children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Include the header."})," Add ",(0,t.jsx)(n.code,{children:"#include <utils/mnetracer.h>"})," to the files you want to trace. A convenient approach is to include it in your project\u2019s ",(0,t.jsx)(n.code,{children:"*_global.h"})," header, which is typically included by every source file in the project."]}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:["With the Utils library linked, the ",(0,t.jsx)(n.code,{children:"TRACE"})," macro defined, and the header included, MNE Tracer is ready to use."]}),"\n",(0,t.jsx)(n.h2,{id:"using-mne-tracer",children:"Using MNE Tracer"}),"\n",(0,t.jsx)(n.h3,{id:"enabling-and-disabling-the-tracer",children:"Enabling and Disabling the Tracer"}),"\n",(0,t.jsxs)(n.p,{children:["Before recording any function calls, initialize the tracer output file with ",(0,t.jsx)(n.code,{children:"MNE_TRACER_ENABLE(filename.json)"}),". The file name can describe the particular test you are running. The file is saved in the same directory as your application binary."]}),"\n",(0,t.jsxs)(n.p,{children:["After this call, every function marked as traceable will be recorded. When you are done tracing, close and finalize the output file with ",(0,t.jsx)(n.code,{children:"MNE_TRACER_DISABLE"}),". No tracing occurs after this point."]}),"\n",(0,t.jsxs)(n.p,{children:["For example, in an application\u2019s ",(0,t.jsx)(n.code,{children:"main()"})," function:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-cpp",children:"int main(int argc, char *argv[])\n{\n    MNE_TRACER_ENABLE(filename.json)\n\n    //... your application starts here\n    //... you can trace specific function calls \n    //... at this point by adding the\n    //... macro MNE_TRACE() to your code.\n\n    MNE_TRACER_DISABLE\n\n    return returnValue;\n}\n"})}),"\n",(0,t.jsx)(n.h3,{id:"specifying-which-functions-to-trace",children:"Specifying Which Functions to Trace"}),"\n",(0,t.jsxs)(n.p,{children:["In a typical C++ application, many generic function calls occur to execute a specific piece of code. To focus on only the functions you care about, add the ",(0,t.jsx)(n.code,{children:"MNE_TRACE()"})," macro as the first line after the opening brace of each function you want to trace:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-cpp",children:"void ImportantClass::importantMethod(int a)\n{\n    MNE_TRACE()\n    //...the method continues here\n    //...\n}\n"})}),"\n",(0,t.jsx)(n.h3,{id:"automatically-tracing-all-methods-in-a-class",children:"Automatically Tracing All Methods in a Class"}),"\n",(0,t.jsxs)(n.p,{children:["If you want to trace every method in a class without manually adding ",(0,t.jsx)(n.code,{children:"MNE_TRACE()"})," to each one, use the provided Python helper script at ",(0,t.jsx)(n.code,{children:"tools/mnetracer.py"}),":"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Add"})," the ",(0,t.jsx)(n.code,{children:"MNE_TRACE()"})," macro to every method:"]}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"python tools/mnetracer.py file=<yourfile.cpp> mode=add\n"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Remove"})," only the automatically added macros (manually placed ",(0,t.jsx)(n.code,{children:"MNE_TRACE()"})," calls are preserved):"]}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"python tools/mnetracer.py file=<yourfile.cpp> mode=delete\n"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Remove all"})," ",(0,t.jsx)(n.code,{children:"MNE_TRACE()"})," occurrences, including manually placed ones:"]}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"python tools/mnetracer.py file=<yourfile.cpp> mode=deleteAll\n"})})]})}function h(e={}){const{wrapper:n}={...(0,c.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(d,{...e})}):d(e)}},38522(e,n,i){i.d(n,{A:()=>r});const r=i.p+"assets/images/tracer_example-5f634fbf71dcdf6ae4662b8a57cdd252.png"},28453(e,n,i){i.d(n,{R:()=>a,x:()=>o});var r=i(96540);const t={},c=r.createContext(t);function a(e){const n=r.useContext(c);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:a(e.components),r.createElement(c.Provider,{value:n},e.children)}}}]);